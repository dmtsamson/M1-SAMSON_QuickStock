<div class="card" style="padding: var(--space-lg)">
  <div style="display:grid; gap: var(--space); grid-template-columns: 1fr 180px auto" class="filters">
    <div>
      <label>Search</label>
      <input class="input" placeholder="Name / Code / Brand" [(ngModel)]="q" name="q">
    </div>
    <div>
      <label>Brand</label>
      <select class="select" [(ngModel)]="brand" name="brand">
        <option value="ALL">All brands</option>
        <option *ngFor="let b of brands" [value]="b">{{ b }}</option>
      </select>
    </div>
    <div style="align-self:end">
      <button class="btn" routerLink="/items/new">➕ New Item</button>
    </div>
  </div>

  <div *ngIf="loading" style="margin-top:16px; color:var(--muted)">Loading…</div>

  <div *ngIf="!loading">
    <table class="table" *ngIf="filtered.length">
      <thead>
        <tr>
          <th (click)="toggleSort('name')">Name</th>
          <th (click)="toggleSort('code')">Code</th>
          <th (click)="toggleSort('brand')">Brand</th>
          <th (click)="toggleSort('unitPrice')">Unit Price</th>
          <th style="width:130px">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let it of filtered; trackBy: trackById">
          <td>{{ it.name }}</td>
          <td>{{ it.code }}</td>
          <td>{{ it.brand }}</td>
          <td>{{ it.unitPrice | currency:'PHP':'symbol':'1.2-2' }}</td>
          <td>
            <button class="btn ghost" (click)="edit(it)">Edit</button>
            <button class="btn" style="margin-left:6px; background:#ef4444; border-color:#ef4444"
                    (click)="del(it)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <p *ngIf="!filtered.length" style="margin:18px 0; color:var(--muted)">No matching items.</p>

    <div style="display:flex; gap:18px; margin-top:12px; color:var(--muted); font-weight:700">
      <span>Total Items: {{ filtered.length }}</span>
      <span>Total Value: {{ totalValue() | currency:'PHP':'symbol':'1.2-2' }}</span>
    </div>
  </div>
</div>
